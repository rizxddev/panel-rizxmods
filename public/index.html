<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Reseller Panel RizxMods</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white">

<!-- ‚úÖ Modal Login -->
<div id="loginModal" class="fixed inset-0 bg-black bg-opacity-80 flex justify-center items-center z-50">
  <form id="loginForm" class="bg-slate-800 p-6 rounded w-80 space-y-3">
    <h2 class="text-lg font-bold">üîê Login Reseller</h2>
    <input type="text" id="loginUsername" placeholder="Username" required class="w-full p-2 bg-slate-700 rounded" />
    <input type="password" id="loginPassword" placeholder="Password" required class="w-full p-2 bg-slate-700 rounded" />
    <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 p-2 rounded">Login</button>
    <p id="loginError" class="text-red-500 text-sm hidden">Username atau password salah.</p>
  </form>
</div>

<!-- ‚úÖ Form Buat Panel -->
<div id="mainContent" class="hidden">
  <h1 class="text-center text-2xl font-bold mt-8">Halo, selamat datang di panel reseller RizxMods</h1>
  <form id="createForm" class="max-w-md mx-auto mt-6 space-y-2">
    <input id="cUsername" placeholder="Username Panel" required class="w-full p-2 rounded bg-slate-800" />
    <input id="cEmail" placeholder="Email Panel" required class="w-full p-2 rounded bg-slate-800" />
    <input id="cServer" placeholder="Nama Server" required class="w-full p-2 rounded bg-slate-800" />
   <select id="cRam" class="w-full p-2 rounded bg-slate-800 text-white">
  <option value="1024">RAM 1 GB</option>
  <option value="2048">RAM 2 GB</option>
  <option value="3072">RAM 3 GB</option>
  <option value="4096">RAM 4 GB</option>
  <option value="5120">RAM 5 GB</option>
  <option value="6144">RAM 6 GB</option>
  <option value="7168">RAM 7 GB</option>
  <option value="8192">RAM 8 GB</option>
  <option value="9216">RAM 9 GB</option>
  <option value="10240">RAM 10 GB</option>
  <option value="0">RAM Unlimited</option>
  </select>
    <button class="bg-green-600 w-full p-2 rounded">üöÄ Buat Panel</button>
  </form>

  <!-- ‚úÖ Output hasil panel dibuat -->
  <div id="result" class="mt-6 hidden max-w-md mx-auto bg-slate-800 rounded p-4 text-sm space-y-2">
    <p>‚úÖ <strong>Panel berhasil dibuat!</strong></p>
    <p><b>Username:</b> <span id="rUsername"></span></p>
    <p><b>Email:</b> <span id="rEmail"></span></p>
    <p><b>Password:</b> <span id="rPassword"></span>
      <button onclick="copyPassword()" class="ml-2 text-blue-400 hover:underline text-xs">Salin</button>
    </p>
  </div>

  <button onclick="logout()" class="mt-8 block mx-auto text-sm underline text-gray-400">Logout</button>
</div>

<!-- ‚úÖ Script Login & Create Panel -->
<script>
  const token = localStorage.getItem("token");
  const role = localStorage.getItem("role");

  if (token && role === "reseller") {
    document.getElementById("loginModal").style.display = "none";
    document.getElementById("mainContent").classList.remove("hidden");
  }

  document.getElementById("loginForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const username = document.getElementById("loginUsername").value;
    const password = document.getElementById("loginPassword").value;

    const res = await fetch("/api/auth", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password })
    });

    const data = await res.json();

    if (res.ok && data.role === "reseller") {
      localStorage.setItem("token", data.token);
      localStorage.setItem("role", data.role);
      document.getElementById("loginModal").style.display = "none";
      document.getElementById("mainContent").classList.remove("hidden");
    } else {
      document.getElementById("loginError").classList.remove("hidden");
    }
  });

  document.getElementById("createForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const username = document.getElementById("cUsername").value;
    const email = document.getElementById("cEmail").value;
    const serverName = document.getElementById("cServer").value;
    const ram = parseInt(document.getElementById("cRam").value);

    const res = await fetch("/api/create-panel", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        username,
        email,
        serverName,
        ram,
        cpu: 0
      })
    });

    const data = await res.json();

    if (res.ok) {
      document.getElementById("rUsername").innerText = username;
      document.getElementById("rEmail").innerText = email;
      document.getElementById("rPassword").innerText = data.password;
      document.getElementById("result").classList.remove("hidden");
    } else {
      alert("‚ùå Gagal: " + data.error);
    }
  });

  function copyPassword() {
    const pass = document.getElementById("rPassword").innerText;
    navigator.clipboard.writeText(pass);
    alert("üîê Password disalin!");
  }

  function logout() {
    localStorage.clear();
    location.reload();
  }
</script>

</body>
</html>