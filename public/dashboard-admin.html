<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Admin - RizxMods</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white p-6">
  <nav class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-indigo-400">Dashboard Admin</h1>
    <button onclick="logout()" class="bg-red-600 px-3 py-1 rounded">Logout</button>
  </nav>

  <h2 class="text-xl font-bold mb-2">ðŸ“Š Statistik</h2>
  <ul class="mb-6 text-slate-300">
    <li id="totalResellers">Reseller: -</li>
    <li id="totalPanels">Panel Aktif: -</li>
  </ul>

  <h2 class="text-lg font-bold mb-2">ðŸ‘¥ Daftar Reseller</h2>
  <button onclick="fetchResellers()" class="bg-yellow-500 text-black px-3 py-1 mb-4 rounded">ðŸ”„ Refresh</button>
  <div id="resellerList"></div>

  <h2 class="text-lg font-bold mt-8 mb-2">âž• Tambah Reseller</h2>
  <input type="text" id="newUsername" placeholder="Username" class="w-full mb-2 p-2 bg-slate-800 rounded" />
  <input type="password" id="newPassword" placeholder="Password" class="w-full mb-2 p-2 bg-slate-800 rounded" />
  <button onclick="addReseller()" class="bg-green-600 px-4 py-2 rounded">Tambah</button>

  <script>
    async function fetchResellers() {
      const res = await fetch("/api/resellers");
      const data = await res.json();
      const container = document.getElementById("resellerList");
      if (res.ok) {
        container.innerHTML = data.resellers.map(r => \`
          <div class="flex justify-between bg-slate-800 p-3 mb-2 rounded">
            <span>\${r.username}</span>
            <button onclick="deleteReseller('\${r.username}')" class="bg-red-600 px-2 py-1 rounded text-sm">Hapus</button>
          </div>\`).join('');
      }
    }

    async function addReseller() {
      const username = document.getElementById("newUsername").value;
      const password = document.getElementById("newPassword").value;
      const res = await fetch("/api/resellers", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password })
      });
      const data = await res.json();
      alert(data.message || data.error);
      fetchResellers();
    }

    async function deleteReseller(username) {
      const res = await fetch("/api/resellers", {
        method: "DELETE",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username })
      });
      const data = await res.json();
      alert(data.message || data.error);
      fetchResellers();
    }

    function logout() {
      localStorage.clear();
      location.href = "/login.html";
    }

    async function updateStats() {
      const res1 = await fetch("/api/resellers");
      const res2 = await fetch("/api/list-panels");
      const r1 = await res1.json();
      const r2 = await res2.json();
      document.getElementById("totalResellers").innerText = "Reseller: " + r1.resellers.length;
      document.getElementById("totalPanels").innerText = "Panel Aktif: " + r2.servers.length;
    }

    fetchResellers();
    updateStats();
  </script>
</body>
</html>